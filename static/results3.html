<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>KRANKENSTATION - PRIORITÄT 1</title>
    <style>
        /* Cruise ship medical system interface */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            background: linear-gradient(135deg, #0a0f23 0%, #1a2338 50%, #0a1422 100%);
            color: #00ff88;
            font-family: 'Courier New', monospace;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        /* Status bar - ship header */
        .ship-status {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 45px;
            background: linear-gradient(90deg, #001122, #003355);
            border-bottom: 2px solid #ff4444;
            display: flex;
            align-items: center;
            padding: 0 30px;
            font-size: 18px;
            letter-spacing: 2px;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(255, 68, 68, 0.3);
        }

        .ship-name { color: #ffffff; font-weight: 900; }
        .status-indicator {
            margin-left: auto;
            color: #ff4444;
            animation: blink 2s infinite;
            font-size: 16px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        #chart-container {
            height: calc(100vh - 65px);
            width: 95%;
            padding: 65px 15px 10px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            background: transparent;
            align-items: stretch;
            margin: 0 auto;
        }

        #chart {
            display: flex;
            flex-direction: column;
            gap: 18px;
            width: 100%;
            flex: 1;
            overflow-y: auto;
            padding-bottom: 30px;
        }

        /* Medical priority panel */
        .bar-row {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 140px;
            background: rgba(40, 10, 10, 0.85);
            border: 2px solid #ff4444;
            border-left: 6px solid #ff4444;
            border-radius: 0;
            position: relative;
            padding: 15px;
            box-shadow:
                    inset 0 1px 0 rgba(255, 68, 68, 0.2),
                    0 0 15px rgba(255, 68, 68, 0.1);
            overflow: hidden;
        }

        /* PRIORITY 1 - Critical patient (GREEN/LIVING) */
        .bar-row.winner {
            border-color: #00ff88;
            border-left-width: 8px;
            background: rgba(0, 25, 10, 0.9);
            box-shadow:
                    inset 0 1px 0 rgba(0, 255, 136, 0.3),
                    0 0 40px rgba(0, 255, 136, 0.4),
                    0 0 80px rgba(0, 255, 136, 0.2);
        }

        /* HEARTBEAT ANIMATION - Priority 1 only */
        .bar-row.winner::after {
            content: '';
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            background: #ff4444;
            border-radius: 50%;
            animation: heartbeat 1.5s ease-in-out infinite both;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.8);
        }

        @keyframes heartbeat {
            0% {
                transform: scale(1) rotate(-15deg);
                opacity: 1;
            }
            14% {
                transform: scale(1.3) rotate(0deg);
                opacity: 1;
            }
            28% {
                transform: scale(1) rotate(15deg);
                opacity: 1;
            }
            42% {
                transform: scale(1.3) rotate(0deg);
                opacity: 1;
            }
            70% {
                transform: scale(1) rotate(-15deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(-15deg);
                opacity: 0;
            }
        }

        /* Medical display headers */
        .bar-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
            height: 48px;
            border-bottom: 1px solid rgba(255, 68, 68, 0.3);
            padding-bottom: 8px;
            position: relative;
            z-index: 3;
        }

        .bar-name {
            font-size: 85px;
            color: #ff7777;
            letter-spacing: 3px;
            text-transform: uppercase;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(255, 119, 119, 0.6);
        }

        .bar-row.winner .bar-name {
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.9);
        }

        .bar-votes {
            font-size: 50px;
            color: #ff9999;
            text-shadow: 0 0 8px rgba(255, 153, 153, 0.6);
            font-weight: 700;
        }

        .bar-row.winner .bar-votes {
            color: #88ffaa;
            text-shadow: 0 0 12px rgba(136, 255, 170, 0.8);
        }

        .bar-container {
            flex: 1;
            display: flex;
            align-items: center;
            position: relative;
            min-height: 70px;
        }

        /* Bar background */
        .bar-bg {
            flex: 1;
            height: 65px;
            border: 2px solid #ff4444;
            background: rgba(20, 5, 5, 0.8);
            display: flex;
            align-items: center;
            padding: 0;
            box-sizing: border-box;
            position: relative;
        }

        /* ✅ SMOOTH LEFT→RIGHT GRADIENT SCAN - Priority 1 ONLY */
        .bar-row.winner .bar-bg {
            border-color: #00ff88;
            box-shadow: inset 0 0 15px rgba(0, 255, 136, 0.2);
            background: rgba(0, 20, 5, 0.8);
            background-image:
                    linear-gradient(90deg,
                    rgba(0, 255, 136, 0.1) 0%,
                    rgba(0, 255, 136, 0.4) 25%,
                    rgba(0, 255, 136, 0.6) 50%,
                    rgba(0, 255, 136, 0.4) 75%,
                    rgba(0, 255, 136, 0.1) 100%);
            background-size: 200% 100%;
            animation: gradient-scan 3s ease-in-out infinite;
        }

        /* ✅ FIXED: LEFT→RIGHT smooth sweep */
        @keyframes gradient-scan {
            0% {
                background-position: 200% 0;  /* Start right */
            }
            100% {
                background-position: 0% 0;    /* End left */
            }
        }

        /* HOLTER MONITOR LINE - Priority 1 background */
        .bar-row.winner .bar-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                    linear-gradient(90deg, transparent 0%, transparent 45%, #00ff88 45%, #00ff88 46%, transparent 46%, transparent 52%, #00ff88 52%, #00ff88 53%, transparent 53%, transparent 100%);
            background-size: 40px 100%;
            animation: holter-monitor 2s linear infinite;
            opacity: 0.3;
            z-index: 1;
            pointer-events: none;
        }

        @keyframes holter-monitor {
            0% { background-position: -100px 0; }
            100% { background-position: 200px 0; }
        }

        .bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff4444, #ff7777);
            transition: width 0.8s ease;
            border-radius: 0;
            box-shadow: 0 0 12px rgba(255, 68, 68, 0.5);
            position: relative;
            z-index: 2;
        }

        .bar-row.winner .bar-fill {
            background: linear-gradient(90deg, #00ff88, #44ffaa, #00ff88);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.7);
        }

        .bar-percent {
            position: absolute;
            right: 12px;
            font-size: 32px;
            font-weight: 900;
            z-index: 10;
            background: rgba(20, 5, 5, 0.95);
            padding: 6px 12px;
            border: 2px solid #ff4444;
            line-height: 1.1;
            min-width: 65px;
            text-align: center;
            color: #ff9999;
            text-shadow: 0 0 8px rgba(255, 153, 153, 0.6);
        }

        .bar-row.winner .bar-percent {
            background: rgba(0, 25, 10, 0.95);
            border-color: #00ff88;
            color: #88ffaa;
            text-shadow: 0 0 12px rgba(136, 255, 170, 0.8);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
        }

        .bar-row::before {
            content: "STANDARD";
            position: absolute;
            top: 8px;
            left: 15px;
            font-size: 14px;
            color: rgba(255, 68, 68, 0.7);
            letter-spacing: 2px;
            z-index: 3;
        }

        .bar-row.winner::before {
            content: "PRIORITY 1";
            color: rgba(0, 255, 136, 0.9);
            font-size: 16px;
        }
    </style>
</head>
<body>
<div class="ship-status">
    <span class="ship-name">MS STELLAMARIS - KRANKENSTATION</span>
    <span class="status-indicator">● BEHANDLUNGSPRIORITÄTEN AKTIV</span>
</div>

<div id="chart-container">
    <div id="chart"></div>
</div>

<script>
    let bars = {};

    async function init() {
        await updateResults();
        setInterval(updateResults, 1000);
    }

    async function updateResults() {
        try {
            const resp = await fetch("/api/get-results");
            if (!resp.ok) return;

            const res = await resp.json();
            if (!res || !res.result) return;

            updateChart(res.result);
        } catch (e) {
            console.error(e);
        }
    }

    function updateChart(results) {
        const chart = document.getElementById("chart");
        if (!chart) return;

        const totalVotes = results.reduce((s, r) => s + r[1], 0);

        Object.values(bars).forEach(({ row }) => row.remove());
        bars = {};

        results
            .sort((a, b) => b[1] - a[1])
            .forEach(([name, votes], index) => {
                const percent = totalVotes > 0
                    ? (votes / totalVotes) * 100
                    : 0;

                const row = document.createElement("div");
                row.classList.add("bar-row");

                if (index === 0) {
                    row.classList.add("winner");
                }

                const header = document.createElement("div");
                header.className = "bar-header";

                const nameEl = document.createElement("div");
                nameEl.className = "bar-name";
                nameEl.textContent = name;

                const votesEl = document.createElement("div");
                votesEl.className = "bar-votes";

                const barContainer = document.createElement("div");
                barContainer.className = "bar-container";

                const percentEl = document.createElement("div");
                percentEl.className = "bar-percent";

                const barBg = document.createElement("div");
                barBg.className = "bar-bg";

                const barFill = document.createElement("div");
                barFill.className = "bar-fill";

                barBg.appendChild(barFill);
                barContainer.append(percentEl, barBg);
                header.append(nameEl, votesEl);
                row.append(header, barContainer);
                chart.appendChild(row);

                bars[name] = { row, barFill, percentEl, votesEl };

                barFill.style.width = percent + "%";
                percentEl.textContent = percent.toFixed(1) + "%";
                votesEl.textContent = votes + " Stimmen";
            });
    }

    window.addEventListener("load", init);
</script>
</body>
</html>
